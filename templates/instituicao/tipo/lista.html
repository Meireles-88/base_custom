{# templates/instituicao/tipo/lista.html #}
{% extends 'logged_in/base_logged_in.html' %}

{% block title %}Tipos de Instituição - SI{% endblock %}

{% block dashboard_content %}
    <div class="page-header">
        <h2 class="page-header-title mb-0">Tipos de Instituição</h2>
    </div>

    {% if messages %}
        {% for message in messages %}
            <div class="alert alert-{% if message.tags %}{{ message.tags }}{% else %}success{% endif %} mt-3">{{ message }}</div>
        {% endfor %}
    {% endif %}

    <div class="content-card mt-3">
        <table class="table table-hover">
            <thead>
                <tr>
                    <th>Nome</th>
                    <th class="text-end">Ações</th>
                </tr>
            </thead>
            <tbody>
                {% for tipo in tipos %}
                <tr>
                    <td>{{ tipo.nome }}</td>
                    <td class="text-end">
                        <a href="{% url 'instituicao:edita_tipo' tipo.pk %}" class="btn btn-sm btn-update"><i class="bi bi-pencil-fill"></i> Editar</a>
                        <a href="{% url 'instituicao:exclui_tipo' tipo.pk %}" class="btn btn-sm btn-danger"><i class="bi bi-trash-fill"></i> Excluir</a>
                    </td>
                </tr>
                {% empty %}
                <tr>
                    <td colspan="2" class="text-center p-4">Nenhum tipo de instituição cadastrado.</td>
                </tr>
                {% endfor %}
                
                {# --- NOVA LINHA PARA O FORMULÁRIO IN-LINE --- #}
                <tr id="add-type-form-row" style="display: none;">
                    <form method="post" id="add-type-form" class="d-contents">
                        {% csrf_token %}
                        <td>
                            {{ form.nome }}
                        </td>
                        <td class="text-end">
                             <button type="button" id="cancel-add-btn" class="btn btn-sm btn-secondary-custom">Cancelar</button>
                             <button type="submit" class="btn btn-sm btn-primary-custom">Salvar</button>
                        </td>
                    </form>
                </tr>
                {# --- FIM DA NOVA LINHA --- #}

            </tbody>
        </table>

        <div class="mt-4 pt-3 border-top">
            <div id="add-type-button-wrapper">
                <button id="show-form-btn" class="btn btn-primary-custom"><i class="bi bi-plus-lg"></i> Adicionar Novo Tipo</button>
            </div>
        </div>

    </div>
{% endblock %}

{% block extra_js %}
    {{ block.super }}
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const showFormBtn = document.getElementById('show-form-btn');
            const formRow = document.getElementById('add-type-form-row');
            const cancelBtn = document.getElementById('cancel-add-btn');
            const buttonWrapper = document.getElementById('add-type-button-wrapper');

            showFormBtn.addEventListener('click', function() {
                formRow.style.display = 'table-row'; // Mostra a linha da tabela
                buttonWrapper.style.display = 'none';
            });

            cancelBtn.addEventListener('click', function() {
                formRow.style.display = 'none'; // Esconde a linha da tabela
                buttonWrapper.style.display = 'block';
            });
        });
    </script>
{% endblock %}