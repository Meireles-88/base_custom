{# templates/logged_in/base_logged_in.html #}
{% extends 'base.html' %}
{% load static %}

{% block extra_head %}
    {# Link para o CSS específico da área logada #}
    <link rel="stylesheet" href="{% static 'css/logged_in_styles.css' %}">
    {# NOVO: Link para Bootstrap Icons (removendo Font Awesome) #}
    <link rel="stylesheet" href="{% static 'css/bootstrap-icons.css' %}">
{% endblock %}

{% block body_attributes %}
    {# A classe 'sidebar-minimized-desktop' ou 'sidebar-expanded-desktop' será adicionada aqui pelo JS #}
    {# E 'sidebar-open-mobile' / 'sidebar-closed-mobile' para mobile #}
    class="sidebar-minimized-desktop" {# Estado inicial no desktop #}
{% endblock %}

{% block content %}
    <div class="dashboard-wrapper">
        {# Sidebar Principal (A que expande/minimiza em desktop, e é modal em mobile) #}
        <aside class="sidebar" aria-label="Navegação Principal">
            <div class="sidebar-header">
                {# Logo/Ícone visível sempre (AGORA COM BOOTSTRAP ICONS) #}
                <a href="{% url 'painel:dashboard' %}" class="system-logo" aria-label="Página Inicial do Dashboard">
                    <img src="{% static 'images/brasao_si.png' %}" alt="Brasão do Sistema" class="system-emblem"> {# Substituído o ícone pelo brasão #}
                    <span class="logo-text">Segurança Integrada</span> {# Texto "SI" para aparecer quando expandido #}
                </a>
                {# Botão para fechar a sidebar (em mobile) - AGORA COM BOOTSTRAP ICONS #}
                <button class="close-sidebar-mobile-btn d-block d-md-none" aria-label="Fechar Menu Lateral">
                    <i class="bi bi-x"></i>
                </button>
            </div>

            {# NOVA ÁREA: Informações da Instituição #}
            <div class="institution-info-area">
                <img src="{% static 'images/brasao_instituicao.png' %}" alt="Brasão da Instituição" class="institution-emblem">
                <div class="institution-details">
                    <span class="institution-type">Guarda Civil Municipal</span> {# Exemplo: Polícia Militar, Corpo de Bombeiros #}
                    <span class="institution-location">Guaira - SP</span> {# Exemplo: São Paulo - SP, Rio de Janeiro - RJ #}
                </div>
            </div>

            <ul class="sidebar-menu">
                <li class="sidebar-menu-item">
                    <a href="{% url 'painel:dashboard' %}" class="{% if request.resolver_match.view_name == 'painel:dashboard' %}active{% endif %}" aria-current="{% if request.resolver_match.view_name == 'painel:dashboard' %}page{% else %}false{% endif %}">
                        <i class="bi bi-speedometer"></i> {# Ícone para Dashboard - de 'home' para 'speedometer' #}
                        <span>Dashboard</span>
                    </a>
                </li>
                <li class="sidebar-menu-item">
                    <a href="#" aria-label="Usuários">
                        <i class="bi bi-people"></i> {# Ícone para Usuários #}
                        <span>Usuários</span>
                    </a>
                </li>
                <li class="sidebar-menu-item">
                    <a href="#" aria-label="Relatórios">
                        <i class="bi bi-file-earmark-text"></i> {# Ícone para Relatórios #}
                        <span>Relatórios</span>
                    </a>
                </li>
                <li class="sidebar-menu-item">
                    <a href="#" aria-label="Configurações">
                        <i class="bi bi-gear"></i> {# Ícone para Configurações #}
                        <span>Configurações</span>
                    </a>
                </li>
            </ul>
        </aside>

        {# Top Navbar #}
        <header class="top-navbar">
            <div class="top-navbar-left">
                {# Botão de toggle para abrir/fechar a sidebar (AGORA SEMPRE HAMBÚRGUER) #}
                <button class="toggle-sidebar-btn" aria-expanded="false" aria-controls="sidebar-navigation">
                    <i class="bi bi-list"></i> {# Ícone sempre 'list' (hambúrguer) #}
                </button>
                <span class="current-page-title">Dashboard</span> {# Este texto pode ser dinâmico via JS ou context #}
            </div>
            <div class="user-profile-widget">
                <img src="{% static 'images/avatar_meireles.jpeg' %}" alt="Avatar do Usuário" class="user-avatar-top"> {# Substitua pela imagem real do avatar #}
                <span class="user-name-top">{{ user.username }}</span>
                <form action="{% url 'autenticacao:logout' %}" method="post" style="display: inline;">
                    {% csrf_token %}
                    <button type="submit" class="logout-link ">Sair</button>
                </form>
            </div>
        </header>

        {# Overlay para quando a sidebar estiver aberta em mobile #}
        <div class="overlay-mobile-sidebar"></div>

        {# Conteúdo Principal #}
        <main class="content-area">
            {% block dashboard_content %}
                {# Conteúdo específico de cada página do dashboard será injetado aqui #}
                
            {% endblock %}
        </main>

        {# Rodapé do Dashboard #}
        <footer class="dashboard-footer">
            <p>&copy; 2025 Sistema SI - Todos os direitos reservados.</p>
        </footer>
    </div>
{% endblock content %}

{% block extra_js %}
    {# Incluir o arquivo JavaScript separado para a lógica da sidebar #}
    <script src="{% static 'js/dashboard_sidebar.js' %}"></script>
{% endblock %}