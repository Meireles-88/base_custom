{# templates/usuario/user_list.html #}
{% extends 'logged_in/base_logged_in.html' %}
{% load static %}

{% block title %}Lista de Usuários - SI{% endblock %}

{% block extra_head %}
    {{ block.super }}
    <link rel="stylesheet" href="{% static 'css/usuario/user_list_styles.css' %}">
{% endblock %}

{% block dashboard_content %}
    <div class="list-page-container">
        <div class="page-header">
            <h2 class="page-header-title">Gerenciamento de Usuários</h2>
        </div>

        <div class="content-card list-card">
            
            <div class="list-card-header">
                <div class="header-title-group">
                    <i class="bi bi-people-fill"></i>
                    <h3>Usuários do Sistema</h3>
                </div>
                <div class="header-actions-group">
                    <a href="{% url 'usuario:user_create' %}" class="btn btn-create"><i class="bi bi-plus-lg"></i> Adicionar Usuário</a>
                    <select id="status-filter" class="form-select-custom">
                        <option value="all">Filtrar por Status</option>
                        <option value="all">Todos</option>
                        <option value="ativo">Ativos</option>
                        <option value="inativo">Inativos</option>
                    </select>
                </div>
            </div>

            <div class="list-card-body">
                <div class="table-responsive-wrapper">
                    <table class="user-list-table">
                        <thead>
                            <tr>
                                <th>Usuário</th>
                                <th>Cargo</th>
                                <th>Instituição</th>
                                <th>Data de Criação</th>
                                <th>Status</th>
                                <th>Ações</th>
                            </tr>
                        </thead>
                        <tbody>
                            {# AQUI ESTÁ A CORREÇÃO: removido o .values #}
                            {% for profile in profiles %}
                                <tr class="user-row" data-username="{{ profile.user.username|lower }}" data-status="{% if profile.ativo %}ativo{% else %}inativo{% endif %}">
                                    <td>{{ profile.user.username }}</td>
                                    <td>{{ profile.cargo|default:"Sem cargo" }}</td>
                                    <td>{{ profile.instituicao|default:"Sem instituição" }}</td>
                                    <td>{{ profile.user.date_joined|date:"d/m/Y H:i" }}</td> {# Usando a data de criação do User #}
                                    <td>{% if profile.ativo %}Ativo{% else %}Inativo{% endif %}</td>
                                    <td class="actions-cell">
                                        <a href="{% url 'usuario:user_profile' profile.pk %}" class="btn btn-action btn-read" title="Visualizar"><i class="bi bi-eye-fill"></i></a>
                                        <a href="{% url 'usuario:user_edit' profile.pk %}" class="btn btn-action btn-update" title="Editar"><i class="bi bi-pencil-fill"></i></a>
                                        <a href="{% url 'usuario:user_delete' profile.pk %}" class="btn btn-action btn-delete" title="Excluir" onclick="return confirm('Tem certeza que deseja excluir este usuário? Esta ação não pode ser desfeita.')"><i class="bi bi-trash-fill"></i></a>
                                    </td>
                                </tr>
                            {% empty %}
                                <tr>
                                    <td colspan="6" class="text-center">Nenhum perfil de usuário encontrado.</td>
                                </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
{% endblock %}